<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Skyforgia |> Create Server</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <script src="https://hcaptcha.com/1/api.js" async defer></script>
  <!-- Favicon -->
<link rel="icon" type="image/png" href="/static/favicon-96x96.webp" sizes="96x96" />
<link rel="icon" type="image/svg+xml" href="/static/favicon.svg" />
<link rel="shortcut icon" href="/static/favicon.ico" />
<link rel="apple-touch-icon" sizes="180x180" href="/static/apple-touch-icon.webp" />
<link rel="manifest" href="/static/site.webmanifest" />

  <!-- Open Graph (untuk share di media sosial) -->
  <meta property="og:title" content="Skyforgia">
  <meta property="og:description" content="Free bot discord & whatsapp hosting.">
  <meta property="og:image" content="https://control.skyforgia.biz.id/static/logo-512x512.webp">
  <meta property="og:url" content="https://control.skyforgia.biz.id">
  <meta property="og:type" content="website">

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Skyforgia">
  <meta name="twitter:description" content="Free bot discord & whatsapp hosting.">
  <meta name="twitter:image" content="https://control.skyforgia.biz.id/static/logo-512x512.webp">

  <!-- Structured Data (Organization Logo Schema) -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Organization",
    "url": "https://control.skyforgia.biz.id",
    "logo": "https://control.skyforgia.biz.id/static/logo-512x512.webp",
    "name": "Skyforgia"
  }
  </script>
  <script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "FAQPage",
  "mainEntity": [{
    "@type": "Question",
    "name": "What is skyforgia Hosting?",
    "acceptedAnswer": {
      "@type": "Answer",
      "text": "skyforgia Hosting provides free hosting for Discord & WhatsApp bots using Pterodactyl Panel."
    }
  },{
    "@type": "Question",
    "name": "Is it free forever??",
    "acceptedAnswer": {
      "@type": "Answer",
      "text": "Yes, there is a free package available with specifications of 1000MB RAM, 3GB disk, and 100 CPU%."
    }
  }]
}
</script>
  <!-- Tom Select -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <link href="https://cdn.jsdelivr.net/npm/tom-select/dist/css/tom-select.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/tom-select/dist/js/tom-select.complete.min.js"></script>
  <style>
    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(24px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .animate-fadeInUp { animation: fadeInUp 0.8s ease-out forwards; }
  </style>
  <style>
/* Tambahan style biar jelas kalau ini dropdown */
.ts-wrapper.single .ts-control::after {
  content: "\f078"; /* fa-chevron-down */
  font-family: "Font Awesome 6 Free";
  font-weight: 900;
  position: absolute;
  right: 12px;
  color: #555;
  pointer-events: none;
}
.ts-wrapper.single .ts-control {
  padding-right: 2rem; /* ruang buat icon dropdown */
}
</style>
</head>
<body class="bg-white min-h-screen flex flex-col">

<!-- HEADER -->
<header class="bg-white border-b border-gray-200 py-3">
  <div class="max-w-screen-lg mx-auto flex justify-between items-center px-4">
    <a href="/getstarted" class="flex items-center space-x-2">
      <img src="/static/logo2.webp" alt="Logo" class="h-10" />
      <span class="text-2xl font-bold text-gray-800">Skyforgia</span>
    </a>
    <div class="flex items-center space-x-3">
      <i class="fa-solid fa-shield-halved text-gray-600 text-lg"></i>
    </div>
  </div>
</header>

<!-- MAIN -->
<main class="flex-grow flex items-center justify-center px-4 py-10 animate-fadeInUp">

  <div class="bg-white rounded-2xl shadow-xl border w-full max-w-4xl grid md:grid-cols-2 overflow-hidden">

    <!-- Panel Kiri — Informasi -->
    <div class="bg-gradient-to-br from-blue-600 to-blue-800 text-white p-8 flex flex-col justify-center space-y-4">
      <div class="space-y-2 text-center">
        <h2 class="text-2xl font-bold">Create Free Server</h2>
        <p class="text-blue-100 text-sm leading-relaxed">
          Complete the steps to launch your free hosting server.
        </p>
      </div>

      <div class="flex justify-center mt-4">
        <i class="fa-solid fa-server text-white/90 text-6xl drop-shadow-md"></i>
      </div>

      <p class="text-xs text-blue-100 text-center">Enjoy free hosting powered by Skyforgia</p>
    </div>

    <!-- Panel Kanan — Form Wizard -->
    <div class="p-8">
      <form method="POST" action="/panel/create" class="space-y-6" id="serverForm">

        <input type="hidden" name="fingerprint" id="fingerprintField">

        <!-- Progress Bar -->
        <div id="progressSteps" class="flex justify-between mb-6 text-xs font-semibold tracking-wide">
          <span class="text-blue-600">Panel</span>
          <span>Name</span>
          <span>Egg</span>
          <span>Node</span>
          <span>Review</span>
          <span>Create</span>
        </div>

        <!-- STEP 1 -->
        <div class="step">
          <label class="block text-sm font-medium text-gray-700">1. Select Panel</label>
          <select name="panel_id" id="panelSelect" onchange="updateServerId(this.value)" required
            class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-400 outline-none">
          </select>

          <p id="error-step-0"
             class="flex items-center gap-2 text-red-500 text-xs mt-1 hidden opacity-0 transition">
             <i class="fa fa-exclamation-circle"></i> Please select a panel first.
          </p>

          <button type="button" onclick="validateStep(0)"
            class="mt-3 bg-blue-600 hover:bg-blue-700 text-white w-full py-2 rounded-lg transition">
            Next
          </button>
        </div>

        <!-- STEP 2 -->
        <div class="step hidden">
          <label class="block text-sm font-medium text-gray-700">2. Server Name</label>
          <input type="text" name="server_name" id="server_name" required
            class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-400 outline-none"/>

          <p id="error-step-1"
             class="flex items-center gap-2 text-red-500 text-xs mt-1 hidden opacity-0 transition">
             <i class="fa fa-exclamation-circle"></i> Server name is required.
          </p>

          <div class="flex gap-3 mt-3">
            <button type="button" onclick="prevStep()"
              class="bg-gray-400 hover:bg-gray-500 text-white px-4 py-2 rounded-lg w-1/2">Back</button>
            <button type="button" onclick="validateStep(1)"
              class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg w-1/2">Next</button>
          </div>
        </div>

        <!-- STEP 3 -->
        <div class="step hidden">
          <label class="block text-sm font-medium text-gray-700">3. Select Egg</label>
          <select name="egg" id="egg" required
            class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-400 outline-none"></select>

          <p id="error-step-2"
             class="text-red-500 text-xs mt-1 hidden opacity-0 transition">
             Please choose eggs first.
          </p>

          <div class="flex gap-3 mt-3">
            <button type="button" onclick="prevStep()"
              class="bg-gray-400 text-white px-4 py-2 rounded-lg w-1/2">Back</button>
            <button type="button" onclick="validateStep(2)"
              class="bg-blue-600 text-white px-4 py-2 rounded-lg w-1/2">Next</button>
          </div>
        </div>

        <!-- STEP 4 -->
        <div class="step hidden">
          <label class="block text-sm font-medium text-gray-700">4. Select Node</label>
          <select name="node" id="node"
            class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-400 outline-none"></select>

          <p id="error-step-3"
             class="text-red-500 text-xs mt-1 hidden opacity-0 transition">
             Please select a node first.
          </p>

          <div class="flex gap-3 mt-3">
            <button type="button" onclick="prevStep()"
              class="bg-gray-400 text-white px-4 py-2 rounded-lg w-1/2">Back</button>
            <button type="button" onclick="validateStep(3)"
              class="bg-blue-600 text-white px-4 py-2 rounded-lg w-1/2">Next</button>
          </div>
        </div>

        <!-- STEP 5 -->
        <div class="step hidden">
          <label class="block text-sm font-medium text-gray-700">5. Review Data</label>
          <div class="bg-gray-50 border rounded-lg p-4 text-sm space-y-2">
            <div class="flex justify-between"><span>Panel</span><span id="reviewPanel"></span></div>
            <div class="flex justify-between"><span>Name</span><span id="reviewName"></span></div>
            <div class="flex justify-between"><span>Egg</span><span id="reviewEgg"></span></div>
            <div class="flex justify-between"><span>Node</span><span id="reviewNode"></span></div>
          </div>

          <div class="flex gap-3 mt-3">
            <button type="button" onclick="prevStep()"
              class="bg-gray-400 text-white px-4 py-2 rounded-lg w-1/2">Back</button>
            <button type="button" onclick="nextStep()"
              class="bg-blue-600 text-white px-4 py-2 rounded-lg w-1/2">Next</button>
          </div>
        </div>

        <!-- STEP 6 -->
        <div class="step hidden text-center">
          <div class="flex justify-center mb-3">
            <div class="h-captcha scale-90" data-sitekey="ebe8e3f6-3040-4338-8e4e-6e38bd5c2464"></div>
          </div>

          <button type="button" id="watchAdBtn" onclick="tontonIklan()"
            class="w-full bg-yellow-500 hover:bg-yellow-600 text-white py-2 rounded-lg font-semibold shadow">
            Watch Ad <i class="fa fa-play-circle"></i>
          </button>

          <button type="button" onclick="prevStep()"
            class="mt-3 bg-gray-400 text-white px-4 py-2 rounded-lg w-full">Back</button>
        </div>

      </form>
    </div>
  </div>
</main>

<!-- LOADING OVERLAY -->
<div id="loadingOverlay" class="fixed inset-0 bg-white bg-opacity-80 flex items-center justify-center z-50 hidden">
  <div class="flex flex-col items-center gap-2">
    <svg class="animate-spin h-10 w-10 text-blue-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
      <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
      <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"></path>
    </svg>
    <p class="text-sm text-gray-600 mt-2">Creating server, please wait...</p>
  </div>
</div>

<div id="ad-bait-container" style="position:absolute; left:-9999px; top:-9999px;"></div>
<!-- Popup Adblock Hard Block -->
<div id="adblock-popup" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 backdrop-blur-sm z-[9999] hidden">
  <div class="bg-white rounded-xl shadow-2xl max-w-sm w-full p-5 text-center animate-fade-in-scale">
    <h2 class="text-xl font-bold text-red-600 mb-2">AdBlock Detected!</h2>
    <p class="text-gray-700 mb-3 text-sm" id="adblock-message">
      Please turn off your AdBlock to continue.<br>
      The page will automatically reload after AdBlock is turned off.
    </p>

    <div class="flex justify-center mb-4">
      <i class="fa-solid fa-triangle-exclamation text-red-500 text-3xl animate-bounce"></i>
    </div>

    <!-- FAQ Section -->
    <div class="text-left mb-4 border-t pt-3">
      <div class="flex justify-between items-center mb-2">
        <h3 class="font-semibold text-gray-800">FAQ</h3>
        <button id="lang-toggle" class="text-sm text-blue-600 hover:underline">
          Bahasa Indonesia
        </button>
      </div>

      <!-- English FAQ -->
      <div id="faq-en" class="space-y-2 text-sm">
        <div class="faq-item border rounded-lg">
          <button class="faq-question w-full text-left px-3 py-2 font-medium text-gray-800 hover:bg-gray-100 transition">
            Why is this happening?
          </button>
          <div class="faq-answer px-3 pb-2 text-gray-600 hidden">
            Because AdBlock is blocking some important scripts on this site.
          </div>
        </div>
        <div class="faq-item border rounded-lg">
          <button class="faq-question w-full text-left px-3 py-2 font-medium text-gray-800 hover:bg-gray-100 transition">
            How to fix it?
          </button>
          <div class="faq-answer px-3 pb-2 text-gray-600 hidden">
            Disable AdBlock for this website, then refresh the page.
          </div>
        </div>
      </div>

      <!-- Indonesian FAQ -->
      <div id="faq-id" class="space-y-2 text-sm hidden">
        <div class="faq-item border rounded-lg">
          <button class="faq-question w-full text-left px-3 py-2 font-medium text-gray-800 hover:bg-gray-100 transition">
            Kenapa ini bisa terjadi?
          </button>
          <div class="faq-answer px-3 pb-2 text-gray-600 hidden">
            Karena AdBlock memblokir beberapa script penting di situs ini.
          </div>
        </div>
        <div class="faq-item border rounded-lg">
          <button class="faq-question w-full text-left px-3 py-2 font-medium text-gray-800 hover:bg-gray-100 transition">
            Bagaimana cara memperbaikinya?
          </button>
          <div class="faq-answer px-3 pb-2 text-gray-600 hidden">
            Nonaktifkan AdBlock untuk situs ini, lalu refresh halaman.
          </div>
        </div>
      </div>
    </div>

      <div class="flex flex-col gap-2">
      <a href="https://t.me/{{ telegram_user }}" target="_blank"
         class="flex items-center justify-center gap-2 bg-blue-500 text-white font-medium py-2 rounded-lg hover:bg-blue-600 transition">
        <i class="fa-brands fa-telegram text-lg"></i> Help 
      </a>
    </div>
  </div>
</div>

<!-- SCRIPT -->
<script>
let currentStep = 0;
const steps = document.querySelectorAll(".step");

function showStep(n) {
  steps.forEach((step, i) => {
    if (i === n) {
      step.classList.remove("hidden");
    } else {
      step.classList.add("hidden");
    }
  });

  // Update progress step indicator dengan animasi
  const indicators = document.querySelectorAll("#progressSteps div.w-8");
  indicators.forEach((el, i) => {
    el.classList.remove("transition-all", "duration-500");
    void el.offsetWidth; // force reflow untuk restart animasi
    el.classList.add("transition-all", "duration-500");

    if (i === n) {
      el.classList.remove("bg-gray-300", "text-gray-600");
      el.classList.add("bg-blue-500", "text-white");
    } else if (i < n) {
      el.classList.remove("bg-gray-300", "text-gray-600");
      el.classList.add("bg-green-500", "text-white");
    } else {
      el.classList.remove("bg-blue-500", "bg-green-500", "text-white");
      el.classList.add("bg-gray-300", "text-gray-600");
    }
  });

  // Update review
  if (n === 4) {
    document.getElementById("reviewPanel").innerText = getSelectedPanelId();
    document.getElementById("reviewName").innerText = document.getElementById("server_name").value;
    document.getElementById("reviewEgg").innerText = document.getElementById("egg").tomselect.getValue() 
      ? document.getElementById("egg").tomselect.getItem(document.getElementById("egg").tomselect.getValue()).innerText 
      : "";
    document.getElementById("reviewNode").innerText = document.getElementById("node").tomselect.getValue() 
      ? document.getElementById("node").tomselect.getItem(document.getElementById("node").tomselect.getValue()).innerText 
      : "";
  }
  if (n === 5) {
  onStep6Open();
}
}

function nextStep(){ if(currentStep<steps.length-1){ currentStep++; showStep(currentStep);} }
function prevStep(){ if(currentStep>0){ currentStep--; showStep(currentStep);} }
document.addEventListener("DOMContentLoaded",()=>{
  showStep(currentStep);

  new TomSelect("#panelSelect",{
    create:false,
    sortField:{field:"text",direction:"asc"}
  });

  new TomSelect("#egg",{
    create:false,
    sortField:{field:"text",direction:"asc"},
    render:{
      option:(data,escape)=>`<div class="flex items-center">${data.icon || ''}<span class="ml-1">${escape(data.text)}</span></div>`,
      item:(data,escape)=>`<div class="flex items-center">${data.icon || ''}<span class="ml-1">${escape(data.text)}</span></div>`
    }
  });

  new TomSelect("#node",{
    create:false,
    sortField:{field:"text",direction:"asc"}
  });
});

function updateReviewRealTime() {
  const panelTS = document.getElementById("panelSelect").tomselect;
  const eggTS = document.getElementById("egg").tomselect;
  const nodeTS = document.getElementById("node").tomselect;
  
  document.getElementById("reviewPanel").innerText = panelTS.getValue() ? panelTS.getItem(panelTS.getValue())[0].innerText : "";
  document.getElementById("reviewEgg").innerText = eggTS.getValue() 
  ? eggTS.getItem(eggTS.getValue()).innerText 
  : "";

document.getElementById("reviewNode").innerText = nodeTS.getValue() 
  ? nodeTS.getItem(nodeTS.getValue()).innerText 
  : "";
  document.getElementById("reviewName").innerText = document.getElementById("server_name").value;
}

// Event listener untuk update otomatis
document.addEventListener("DOMContentLoaded", () => {
  const panelTS = document.getElementById("panelSelect").tomselect;
  const eggTS = document.getElementById("egg").tomselect;
  const nodeTS = document.getElementById("node").tomselect;
  
  panelTS.on("change", updateReviewRealTime);
  eggTS.on("change", updateReviewRealTime);
  nodeTS.on("change", updateReviewRealTime);
  document.getElementById("server_name").addEventListener("input", updateReviewRealTime);
});

function getSelectedPanelId() {
  return document.getElementById("panelSelect").value;
}

function updateServerId(panelId) {
  if (!panelId) return;

  // ambil elemen tomselect
  const eggEl = document.getElementById("egg");
  const nodeEl = document.getElementById("node");

  // kosongkan value + options agar pilihan lama hilang dan user harus pilih lagi
  if (eggEl && eggEl.tomselect) {
    try {
      const eggTS = eggEl.tomselect;
      eggTS.clear();         // hapus nilai terpilih
      eggTS.clearOptions();  // hapus opsi lama
      eggTS.refreshOptions(false);
    } catch (err) {
      console.warn("Gagal mengosongkan egg tomselect:", err);
    }
  }

  if (nodeEl && nodeEl.tomselect) {
    try {
      const nodeTS = nodeEl.tomselect;
      nodeTS.clear();
      nodeTS.clearOptions();
      nodeTS.refreshOptions(false);
    } catch (err) {
      console.warn("Gagal mengosongkan node tomselect:", err);
    }
  }

  // kosongkan teks di review supaya langsung terlihat kosong
  const revEgg = document.getElementById("reviewEgg");
  const revNode = document.getElementById("reviewNode");
  if (revEgg) revEgg.innerText = "";
  if (revNode) revNode.innerText = "";

  // lalu kirim request ke server seperti biasa
  fetch("/panel/set-serverid?email={{ user.email }}", {
    method: "POST",
    headers: { "Content-Type": "application/x-www-form-urlencoded" },
    body: "panel_id=" + encodeURIComponent(panelId),
    credentials: "include"
  })
  .then(res => res.json())
  .then(data => {
    if (data.success) {
      fetchEggs();
      fetchServerCounts();
    } else {
      console.error("Gagal set serverid:", data.message);
    }
  })
  .catch(err => console.error("Error update serverid:", err));
}

function submitForm() {
  const form = document.getElementById("serverForm");
  const captcha = document.querySelector('[name="h-captcha-response"]');
  
  if (!captcha || !captcha.value) { 
    alert("Please complete captcha"); 
    return; 
  }
  
  if (!sudahNonton) { 
    alert("Please watch the ad first"); 
    return; 
  }
  
  // Tampilkan loading overlay
  document.getElementById("loadingOverlay").classList.remove("hidden");
  
  // Submit form
  form.submit();
}

async function fetchServerCounts(){
  const panelId=getSelectedPanelId();
  if(!panelId)return;
  const res=await fetch(`/get-node-server-counts?panel_id=${panelId}`);
  const serverCounts=await res.json();

  const tom = document.getElementById("node").tomselect;
  tom.clearOptions();
  tom.addOption({value:"",text:"Select Node",disabled:true});

  Object.entries(serverCounts.nodes).forEach(([nodeId,info])=>{
    tom.addOption({
      value: nodeId,
      text: `${info.name} (${info.count}/${info.limit}) ${info.count>=info.limit?"Full":"Available"}`,
      disabled: info.count>=info.limit
    });
  });
  tom.refreshOptions(false);

  // Tambahkan update review otomatis
  if(typeof updateReviewRealTime === "function") updateReviewRealTime();
}

async function fetchEggs(){
  const panelId = getSelectedPanelId();
  if(!panelId) return;

  const res = await fetch(`/get-eggs?panel_id=${panelId}`);
  const data = await res.json();

  const tom = document.getElementById("egg").tomselect;
  tom.clearOptions();
  tom.addOption({value:"",text:"Select Egg",disabled:true});

  if(data.eggs && Array.isArray(data.eggs)){
    data.eggs.forEach(egg=>{
      let icon = "";

      switch (egg.nest.toLowerCase()) {
        case "nodejs":
          icon = '<i class="fa-brands fa-node-js text-green-600 mr-2"></i>';
          break;
        case "python":
          icon = '<i class="fa-brands fa-python text-blue-500 mr-2"></i>';
          break;
        case "bedrock":
          icon = '<i class="fa-solid fa-cube text-yellow-600 mr-2"></i>';
          break;
        default:
          icon = '<i class="fa-solid fa-server text-gray-500 mr-2"></i>';
      }

      tom.addOption({
        value: egg.id,
        text: `${egg.nest} - ${egg.name}`,
        icon: icon
      });
    });
  } else {
    tom.addOption({value:"",text:"No eggs available",disabled:true});
  }
  tom.refreshOptions(false);

  // Tambahkan update review otomatis
  if(typeof updateReviewRealTime === "function") updateReviewRealTime();
}

document.getElementById("serverForm").addEventListener("submit", function(e) {
  const captcha = document.querySelector('[name="h-captcha-response"]');
  
  // Validasi captcha
  if (!captcha || !captcha.value) { 
    e.preventDefault(); 
    alert("Please complete captcha"); 
    return; 
  }
  
  // Validasi sudah nonton iklan
  if (!sudahNonton) { 
    e.preventDefault(); 
    alert("Please watch the ad first"); 
    return; 
  }
  
  // Jika semua validasi lolos, tampilkan loading
  document.getElementById("loadingOverlay").classList.remove("hidden");
  
  // Biarkan form submit secara normal
});
</script>
<script>
function showError(stepIndex) {
  const el = document.getElementById(`error-step-${stepIndex}`);
  el.classList.remove("hidden");
  requestAnimationFrame(() => {
    el.classList.remove("opacity-0");
    el.classList.add("opacity-100");
  });
}

function hideError(stepIndex) {
  const el = document.getElementById(`error-step-${stepIndex}`);
  el.classList.remove("opacity-100");
  el.classList.add("opacity-0");
  setTimeout(() => el.classList.add("hidden"), 300); // sesuai duration-300
}

function validateStep(stepIndex) {
  let valid = true;

  if (stepIndex === 0) {
    valid = !!document.getElementById("panelSelect").value;
  } else if (stepIndex === 1) {
    valid = !!document.getElementById("server_name").value.trim();
  } else if (stepIndex === 2) {
    valid = !!document.getElementById("egg").value;
  } else if (stepIndex === 3) {
    valid = !!document.getElementById("node").value;
  }

  if (valid) {
    hideError(stepIndex);
    nextStep();
  } else {
    showError(stepIndex);
  }
}
</script>
<script>
function onStep6Open() {
  const email = "{{ user.email }}";

  fetch("/panel/create-user", {
    method: "POST",
    headers: {
      "Content-Type": "application/json"
    },
    body: JSON.stringify({ email }) // kirim email ke server
  })
    .then(res => res.json())
    .then(data => {
      if (data.success) {
        console.log("✅ Pterodactyl user created", data.id);
      } else {
        console.log("❌ Gagal membuat user Pterodactyl!", data.msg);
      }
    })
    .catch(err => console.error("Error create user:", err));
}
</script>
<script>
async function fetchPanelsStatus(){
  try {
    const res = await fetch("/get-all-panels-status");
    const panelsStatus = await res.json();

    const select = document.getElementById("panelSelect");

    // kalau pakai TomSelect, harus akses instance
    const ts = select.tomselect;

    ts.clearOptions(); // hapus semua opsi lama

    // Tambahkan default option
    ts.addOption({ value: "", text: "Select Panel", disabled: true });
    ts.setValue(""); // reset ke default

    // Tambah option dari API
    Object.entries(panelsStatus).forEach(([panelId, info]) => {
      ts.addOption({
        value: panelId,
        text: info.all_full ? `${panelId} (Full)` : panelId,
        disabled: info.all_full
      });
    });

    ts.refreshOptions(false); // refresh tampilan

  } catch (err) {
    console.error("Gagal ambil status panels:", err);
  }
}

document.addEventListener("DOMContentLoaded", fetchPanelsStatus);
</script>
<script>
let sudahNonton = false;

function tontonIklan() {
  const tombol = document.getElementById('watchAdBtn');
  if (sudahNonton) {
    // Jika sudah nonton, langsung submit form
    submitForm();
    return;
  }
  
  // Buka iklan di tab baru
  window.open('https://sawutser.top/4/9325836','_blank');
  
  // Ubah tombol setelah 5 detik
  setTimeout(() => {
    sudahNonton = true;
    tombol.innerHTML = '<i class="fa fa-check-circle"></i> Create Server Now';
    tombol.classList.remove('bg-yellow-500'); 
    tombol.classList.add('bg-blue-600');
  }, 5000);
}
</script>
<script src="https://fpyf8.com/88/tag.min.js" data-zone="183700" async data-cfasync="false"></script>
<script>
document.addEventListener("DOMContentLoaded", () => {
  let adblockDetected = false;

  const baitKeywords = [
    "ads","adsbygoogle","ad-banner","sponsor","ad-container","advertisement",
    "adsbox","ad_unit","pub_300x250","doubleclick","affiliate","popup-ad",
    "side-ad","footer-ad","header-ad","mrec-ad","sky-ad","sidebar-ads",
    "promoted-link","sponsored","ad-tracker","adframe","adscript","adlabel",
    "overlay-ad","top-ad","bottom-ad","inline-ad","native-ad","video-ad",
    "banner-ad","display-ad","rightad","leftad","google-ads","openx-ad",
    "adchoice","sponsorship","tracking-ad","clickad","customad"
  ];

  const container = document.getElementById("ad-bait-container");
  for (let i = 0; i < 100; i++) {
    const div = document.createElement("div");
    const kw = baitKeywords[Math.floor(Math.random() * baitKeywords.length)];
    div.id = "bait-" + kw + "-" + i;
    div.className = kw;
    div.innerHTML = "&nbsp;";
    div.style.cssText = "width:1px;height:1px;position:absolute;left:-9999px;top:-9999px;";
    container.appendChild(div);
  }

  const originalCount = container.childElementCount;

  function showPopup() {
    if (!adblockDetected) {
      adblockDetected = true;
      document.getElementById("adblock-popup").classList.remove("hidden");
      document.body.style.overflow = "hidden";
    }
  }

  function hidePopup() {
    if (adblockDetected) {
      adblockDetected = false;
      document.getElementById("adblock-popup").classList.add("hidden");
      document.body.style.overflow = "";
    }
  }

  function isHidden(el) {
    if (!el) return true;
    const style = window.getComputedStyle(el);
    return (
      el.offsetParent === null ||
      el.offsetHeight === 0 ||
      style.display === "none" ||
      style.visibility === "hidden"
    );
  }

  function checkElementBait() {
    const baits = container.children;
    if (baits.length < originalCount) return true; // adblock menghapus node

    for (let el of baits) {
      if (isHidden(el)) {
        return true;
      }
    }
    return false;
  }

  async function checkRequestBait() {
    try {
      // test request ke domain iklan umum, diblokir = adblock aktif
      await fetch("https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js", { method: "HEAD", mode: "no-cors" });
      return false;
    } catch (err) {
      return true;
    }
  }

  async function runCheck() {
    const elementBlocked = checkElementBait();
    const requestBlocked = await checkRequestBait();
    if (elementBlocked || requestBlocked) {
      showPopup();
    } else {
      hidePopup();
    }
  }

  // Periksa beberapa kali dengan penundaan berbeda
  setTimeout(runCheck, 1500);
  setTimeout(runCheck, 4000);
  setInterval(runCheck, 8000);
});
</script>
</body>
</html>
